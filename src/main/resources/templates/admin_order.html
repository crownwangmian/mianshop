<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>订单管理</title>
</head>
<body>
<h1>订单管理</h1>

<script>
    function updateOrderStatus(orderId, status) {
        fetch(`/admin/order/update/${orderId}/${status}`, {
            method: 'PUT',
            headers: {
                'Content-Type': 'application/json'
            }
        }).then(response => {
            if (response.ok) {
                alert("✅ 订单状态已更新");
                window.location.reload(); // 刷新页面
            } else {
                alert("❌ 更新失败");
            }
        });
    }
</script>

<table border="1">
    <tr>
        <th>订单号</th>
        <th>总价</th>
        <th>状态</th>
        <th>操作</th>
        <th>商品明细</th>
    </tr>
    <tr th:each="order : ${orders}">
        <td th:text="${order.id}"></td>
        <td th:text="${order.totalFee}"></td>
        <td>
            <select th:id="'status-' + ${order.id}" th:value="${order.status}">
                <option value="0" th:selected="${order.status == 0}">未处理</option>
                <option value="1" th:selected="${order.status == 1}">已处理</option>
            </select>
        </td>
        <td>
            <button th:onclick="'updateOrderStatus(' + ${order.id} + ', document.getElementById(\'status-' + ${order.id} + '\').value)'">
                更新
            </button>
        </td>
        <td>
            <!-- 展开商品详情 -->
            <details>
                <summary>查看商品详情</summary>
                <table border="1">
                    <tr>
                        <th>商品名称</th>
                        <th>规格</th>
                        <th>数量</th>
                        <th>单价</th>
                    </tr>
                    <tr th:each="detail : ${order.orderDetails}">
                        <td th:text="${detail.name}"></td>
                        <td th:text="${detail.spec} ?: '-'"></td>
                        <td th:text="${detail.quantity}"></td>
                        <td th:text="${detail.price}"></td>
                    </tr>
                </table>
            </details>
        </td>
    </tr>
    <tr th:if="${#lists.isEmpty(orders)}">
        <td colspan="5" style="text-align: center;">没有订单</td>
    </tr>
</table>

<a href="/admin/dashboard">返回管理首页</a>
</body>
</html>
